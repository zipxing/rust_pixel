# 动态字体渲染 (Dynamic Font Rendering)

## Why

当前图形模式使用 2048x2048 统一符号纹理 (`symbols.png`)，其中 TUI 区域 (Block 48-52) 提供 640 个预渲染字符。这存在两个主要问题：

- **CJK 支持有限**: 640 个字符无法覆盖数量庞大的中日韩字符集（2万+字符）
- **缩放后不清晰**: 虽然图形模式已支持任意缩放，但预渲染的位图纹理在放大时会出现模糊或锯齿（这是位图缩放的固有限制）

这限制了 rust_pixel 在需要完整 Unicode 支持和高质量文本显示的应用场景中的可用性。

## What Changes

- 添加基于 `fontdue` 库的动态字体光栅化功能，作为现有 TUI 纹理系统的**扩展**
- 实现混合渲染模式（按优先级）:
  1. **Sprite 符号** (U+E000~U+E0FF): 使用 Sprite 区域 (Block 0-47)
  2. **预渲染 TUI 字符**: 使用 TUI 区域 (Block 48-52)，640 个字符
  3. **预渲染 Emoji**: 使用 Emoji 区域 (Block 53-55)，192 个 Emoji
  4. **动态光栅化**: CJK 及其他 Unicode 字符
- 添加独立的动态纹理图集（1024x1024 @ 1x，随 DPI 缩放），采用 block-based 布局
- 添加带 LRU 缓存的延迟加载机制
- **DPI 感知光栅化**: 根据窗口 scale_factor 动态调整字体渲染尺寸
- 保持单次 draw call 渲染性能

**性能特征:**
- 首次字符渲染: ~0.05-0.1ms (含缓存)
- 缓存字符渲染: 0ms (等同于静态纹理)
- 启动时预加载常用字符

**清晰度优势:**
- 按实际显示分辨率光栅化，而非缩放位图
- 放大后仍保持锐利边缘，无模糊或锯齿
- HiDPI/Retina 显示器原生支持

## Impact

**影响的规范:**
- `rendering` - 新增动态字体渲染能力

**影响的代码:**
- `src/render/adapter/*/render_symbols.rs` - 所有图形模式适配器的符号渲染
- `src/render/graph.rs` - 添加 `GlyphRenderer` 和动态纹理管理
- `src/asset.rs` - 字体资源加载和管理
- `Cargo.toml` - 添加 `fontdue = "0.8"` 和 `lru = "0.12"` 依赖

**破坏性变更:**
- 无 - 这是增强现有功能的附加特性

**迁移:**
- 现有应用无需修改即可继续工作
- 应用可通过加载 TTF 字体选择启用 CJK 支持
